# Electromagnetic Fault Injection as a New Forensic Approach for SoCs阅读笔记

文章讲述了一种通过电磁故障注入技术对Linux及衍生系统内部敏感信息司法调查取证的手段。文章所使用的SoC是一个4核心的CortexA53，采用ARMv8-A构架，兼容ARMv7指令。使用的注入设备由树莓派控制，EMFI所使用的脉冲发生器可以提供一个400 V的上升时间为2 ns的脉冲。最终目标则是通过EMFI获取Linux系统下的Root权限。

文章先介绍了一些常用的攻击手段以及EMFI在1GHz 以上的SoC上注入的难点、使用的SoC和EMFI注入设备。

之后描述了EMFI实现的思路。对于故障的注入，首先要弄清楚何时，在哪产生干扰。

为了确定EMFI时机，论文给出了一个测试代码。

```assembly
mov x28, #0170
sub x19, x28, #0x1
sub x20, x19, #0x1
sub x21, x20, #0x1
...
sub x28, x27, #0x1
```

首先将0x170赋值给x28寄存器，减1赋给x19，减1赋给x20，一直到x28，重复运行32次。执行后x19到x28对应的值为0x39,0x38,0x37,0x36,0x35,0x34,0x33,0x32,0x31,0x30。同时还需要通过SEMA来分析SoC何时在执行NOP何时在处理数据（执行测试代码）。

经过验证，只有一颗核心对电磁注入敏感，因此需要在特定的位置注入。

EMFI的结果包括无效注入、注入成功和freeze、reboot，论文中推测freeze是由UARTS导致的、reboot则是PC计数器异常导致的。在注入成功和无效注入的结果里

| REF. | Occurrences | Result (x19, ..., x28)        | Proportion |
| ---- | ----------- | ----------------------------- | ---------- |
| A    | 27287       | 39,38,37,36,35,34,33,32,31,30 | 71.0%      |
| B    | 5314        | 连接丢失                      | 13.8%      |
| C    | 4899        | 43,42,41,40,3F,3E,3D,3C,3B,3A | 12.7%      |
| D    | 48          | 39,38,37,36,35,3E,3D,3C,3B,3A | 0.1%       |
| E    | 28          | 39,42,41,40,3F,3E,3D,3C,3B,3A | 0.1%       |

A为无效注入，B为连接丢失，主要出现在注入时机过早的情况（相较于C的时机），C推测为跳过了某一条sub指令。DE主要出现在注入时机过晚的情况（相对于C），同样是指令跳过，只是发生在最后10条。

由此可以分析出，可以通过EMFI实现指令跳过从而提权。

最后一部分是对Linux鉴权机制的分析。Linux在校验密码时，先将用户输入的密码Hash，而后strcmp，因此可以从strcmp入手。
